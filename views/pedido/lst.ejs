<%- include('../partials/header') %>

<div class="container">
  <h1 class="title mb-4">Lista de Pedidos</h1>

  <!-- FILTRO -->
  <form method="GET" action="/pedido/lst" class="row g-2 mb-4">

    <div class="col-md-6">
      <input type="text" 
             name="busca" 
             class="form-control" 
             placeholder="Buscar por nome do lanche" 
             value="<%= busca %>">
    </div>

    

    <div class="col-md-3">
      <button class="btn btn-primary w-100">Filtrar</button>
    </div>

  </form>

  <!-- TABELA -->
  <table class="table">
    <thead>
      <tr>
        <th>Usuário</th>
        <th>Itens</th>
        <th>Total</th>
        <th>Ações</th>
      </tr>
    </thead>

    <tbody>
      <% pedidos.forEach(p => { %>
        <tr>
          <td><%= p.usuario ? p.usuario.nome : "Usuário removido" %></td>

          <td>
            <% p.itens.forEach(i => { %>
              <div>
                <strong><%= i.lanche ? i.lanche.nome : "Lanche removido" %></strong>
                — Qtd: <%= i.quantidade %>
              </div>
            <% }) %>
          </td>

          <td>R$ <%= p.total.toFixed(2) %></td>

          <td>
            <a href="/pedido/delete/<%= p._id %>"
               onclick="return confirm('Excluir pedido definitivamente?')" 
               class="btn btn-danger btn-sm">Excluir</a>
          </td>
        </tr>
      <% }) %>

      <% if (pedidos.length === 0) { %>
      <tr>
        <td colspan="4" class="text-center text-muted">Nenhum pedido encontrado.</td>
      </tr>
      <% } %>

    </tbody>

  </table>
</div>

<%- include('../partials/footer') %>
